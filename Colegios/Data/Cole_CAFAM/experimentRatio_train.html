<!DOCTYPE html>
<html>
  <head>
    <title>My experiment TRAIN FRACTIONS </title>
  </head>
  <style>
  	body{height:100%; width:100%}
	html{height:100%; width:100%}
	.button1 {font-size: 5px;}
  </style>
  <body> 
	  <img src="img2/blue.png" id="ph" alt="HTML5 Icon" width="0" height="0"> <!-- place holder for images to be shown -->
	  <button  id = 'sid' style = "z-index: 1" onclick="mySubjID();" class="button button1">SID</button> <!-- ask subj. id -->	  
	  <p id = 'Xc'> X </p>
	  <p id = 'Yc'> Y </p>
	  
  </body>
  
  <script>
	
	 // <button  id = 'O' style = "z-index: 1" onclick="openFullscreen();" class="button button1">O</button> <!-- opens full screen -->
	  //<button  id = 'C' style = "z-index: 1" onclick="closeFullscreen();" class="button button1">C</button> <!-- closes full screen -->
	  //file:///storage/emulated/0/NumExp/*.html EXAMPLE OF PATH FOR ANDROID 
  	////////////// VARIABLES ///////////////
	
	
	var trialStarted = 10;
	var fixOn = 0;
  	var stimOn = 0;
  	var leftSR = 0; //index left start region
  	var xM = 0; //mouse x coordinate
  	var yM = 0; //mouse y coordinate
  	var trial = 0;
  	var sideResp = 0; // 1 left, 2 right
	var rest = 0; // rest screen is off (0), or moved from on to off (1)
	var rest_temp = 0; // to avoid repainting the rest font
	var feedback = 500; // duration of feedback in ms
  	var DATA = [];
  	var test = { //Test trials variables
  		fix_dur: [250, 1500], //[max, min] of fix duration (ms)	
		timestim: 1500, //how much time is the stimulus on screen (ms)	
  		targets_dim: [100,100], //[height, width] pixels
  		targets_relative_coord: [.3, .7], //Horz. coord. [leftcoordT1, leftcoordT2 ] in % of the body-tag width; 
  		size_stim: [880,420], //[height, width] 
  		start_dim: [100,100],  //[height, width] 
  		size_start: [300,300], //[height, width] ... size where finger/mouse should start  
  	    //choices: ['f', 'j'], // 'The keys the subject is allowed to press to respond to the stimulus.'
  		size_fix: 60, //px
  		samplingrate: 20, //sampling rate (in ms) e.g. 20 is one sample every 20 ms
		img_types: ['Congruent', 'Incongruent','Equal'], //Name of folders in each ratio folder. equaldotsize: all dots equal size; equaldotanddens: all dots equal size and both clouds have equal density; randomdotsize: dots have random size; randomdotsizeEA: dots have random size and both clouds have equal cumulative area across dots
		ratios: [100, 200, 300, 500], //Ratio distance between the two options. Distances are out of 1000 e.g. 250 is a 0.25 ratio
		rep_conds: 50, //Number of times experimental conditions are repeated e.g. if 0 only once every condition; e.g. 2 if 2, then exp_conditions will be looped 3 times (1 original and 2 additional repetitions)
		nTrials: 0, //Number of trials (updated below)
		trials_to_rest: 100, //Number of trials before resting screen
		Trials_order: [], //index to randomize exp_cond_rep i.e. vector with images shown
		cond_shown: [], //IMPORTANT: condition shown each trial as described in exp_cond_rep i.e. this is exp_cond_rep randomized (see below) 
	 	ratio_trial:[], //IMPORTANT: ratio distance shown on trial (over 1000)
		left_num: [], //IMPORTANT: left numerator on trial
		right_num: [], //IMPORTANT: right numerator on trial
		left_den: [], //IMPORTANT: left denominator on trial
		right_den: [], //IMPORTANT: right denominator on trial
		correct_side: [], //IMPORTANT: side of larger ratio (1 left, 2 right)
		img_shown: [], //IMPORTANT: filename i.e. image presented
		
		//What follows are arrays with file names with images e.g. L_250 is ratio zero with larger image on the left 
		//(TO IMPROVE; THIS IS BRUTE FORCE i.e. MANUALLY COPY AND PASTE FROM CSV FILES; I HAVENT BEEN ABLE TO READ CSV FILE)
		//Images were randomly generated in R in the script MakeDotArray.R. 
		
		//(file names in each folder)(first element images with correct on the left; second element images with correct on the right)
		//(file names in each folder)(first element images with correct on the left; second element images with correct on the right)
		dist100_C: [["C_Dist_100_LN_10_LD_25_RN_3_RD_10_0.png","C_Dist_100_LN_11_LD_22_RN_4_RD_10_0.png","C_Dist_100_LN_11_LD_22_RN_6_RD_15_0.png","C_Dist_100_LN_15_LD_25_RN_13_RD_26_0.png","C_Dist_100_LN_3_LD_6_RN_2_RD_5_0.png","C_Dist_100_LN_6_LD_20_RN_5_RD_25_0.png","C_Dist_100_LN_8_LD_16_RN_2_RD_5_0.png","C_Dist_100_LN_9_LD_15_RN_8_RD_16_0.png"], ["C_Dist_100_LN_1_LD_2_RN_18_RD_30_1.png","C_Dist_100_LN_1_LD_2_RN_3_RD_5_1.png","C_Dist_100_LN_12_LD_30_RN_13_RD_26_1.png","C_Dist_100_LN_2_LD_5_RN_11_RD_22_1.png","C_Dist_100_LN_2_LD_5_RN_6_RD_12_1.png","C_Dist_100_LN_3_LD_20_RN_4_RD_16_1.png","C_Dist_100_LN_4_LD_10_RN_15_RD_30_1.png","C_Dist_100_LN_4_LD_8_RN_6_RD_10_1.png","C_Dist_100_LN_6_LD_12_RN_15_RD_25_1.png","C_Dist_100_LN_7_LD_14_RN_15_RD_25_1.png","C_Dist_100_LN_7_LD_14_RN_9_RD_15_1.png"]], // congruent		
		dist100_I: [["I_Dist_100_LN_1_LD_2_RN_8_RD_20_0.png","I_Dist_100_LN_2_LD_4_RN_6_RD_15_0.png","I_Dist_100_LN_2_LD_4_RN_8_RD_20_0.png","I_Dist_100_LN_3_LD_5_RN_11_RD_22_0.png","I_Dist_100_LN_3_LD_5_RN_8_RD_16_0.png","I_Dist_100_LN_3_LD_6_RN_4_RD_10_0.png","I_Dist_100_LN_3_LD_9_RN_7_RD_30_0.png","I_Dist_100_LN_4_LD_8_RN_8_RD_20_0.png","I_Dist_100_LN_6_LD_10_RN_11_RD_22_0.png","I_Dist_100_LN_6_LD_10_RN_13_RD_26_0.png","I_Dist_100_LN_6_LD_10_RN_7_RD_14_0.png","I_Dist_100_LN_9_LD_10_RN_20_RD_25_0.png","I_Dist_100_LN_9_LD_15_RN_13_RD_26_0.png","I_Dist_100_LN_9_LD_15_RN_14_RD_28_0.png"], ["I_Dist_100_LN_10_LD_25_RN_8_RD_16_1.png","I_Dist_100_LN_10_LD_25_RN_9_RD_18_1.png","I_Dist_100_LN_11_LD_22_RN_9_RD_15_1.png","I_Dist_100_LN_12_LD_24_RN_9_RD_15_1.png","I_Dist_100_LN_12_LD_30_RN_2_RD_4_1.png","I_Dist_100_LN_13_LD_26_RN_12_RD_20_1.png","I_Dist_100_LN_13_LD_26_RN_6_RD_10_1.png","I_Dist_100_LN_17_LD_30_RN_10_RD_15_1.png","I_Dist_100_LN_6_LD_12_RN_3_RD_5_1.png","I_Dist_100_LN_8_LD_16_RN_6_RD_10_1.png","I_Dist_100_LN_8_LD_20_RN_1_RD_2_1.png","I_Dist_100_LN_9_LD_18_RN_6_RD_10_1.png"]],	
		dist100_S: [["E_Dist_100_LN_2_LD_12_RN_2_RD_30_0.png","E_Dist_100_LN_6_LD_10_RN_6_RD_12_0.png"], ["E_Dist_100_LN_6_LD_12_RN_6_RD_10_1.png"]],
		
		dist200_C: [["C_Dist_200_LN_11_LD_22_RN_3_RD_10_0.png","C_Dist_200_LN_12_LD_15_RN_6_RD_10_0.png","C_Dist_200_LN_12_LD_20_RN_6_RD_15_0.png","C_Dist_200_LN_14_LD_28_RN_6_RD_20_0.png","C_Dist_200_LN_15_LD_25_RN_4_RD_10_0.png","C_Dist_200_LN_16_LD_20_RN_12_RD_20_0.png","C_Dist_200_LN_16_LD_30_RN_9_RD_27_0.png","C_Dist_200_LN_20_LD_25_RN_9_RD_15_0.png","C_Dist_200_LN_21_LD_30_RN_2_RD_4_0.png","C_Dist_200_LN_4_LD_10_RN_3_RD_15_0.png","C_Dist_200_LN_4_LD_8_RN_3_RD_10_0.png","C_Dist_200_LN_6_LD_15_RN_3_RD_15_0.png","C_Dist_200_LN_7_LD_21_RN_2_RD_15_0.png","C_Dist_200_LN_8_LD_15_RN_2_RD_6_0.png","C_Dist_200_LN_8_LD_15_RN_3_RD_9_0.png","C_Dist_200_LN_8_LD_15_RN_7_RD_21_0.png","C_Dist_200_LN_9_LD_20_RN_4_RD_16_0.png"], ["C_Dist_200_LN_1_LD_2_RN_21_RD_30_1.png","C_Dist_200_LN_13_LD_26_RN_14_RD_20_1.png","C_Dist_200_LN_3_LD_10_RN_11_RD_22_1.png","C_Dist_200_LN_3_LD_10_RN_14_RD_28_1.png","C_Dist_200_LN_3_LD_10_RN_7_RD_14_1.png","C_Dist_200_LN_3_LD_12_RN_9_RD_20_1.png","C_Dist_200_LN_3_LD_6_RN_14_RD_20_1.png","C_Dist_200_LN_5_LD_10_RN_14_RD_20_1.png","C_Dist_200_LN_6_LD_12_RN_7_RD_10_1.png","C_Dist_200_LN_6_LD_20_RN_11_RD_22_1.png","C_Dist_200_LN_7_LD_15_RN_18_RD_27_1.png","C_Dist_200_LN_9_LD_30_RN_13_RD_26_1.png"]], // congruent	
		dist200_I: [["I_Dist_200_LN_1_LD_2_RN_3_RD_10_0.png","I_Dist_200_LN_1_LD_3_RN_2_RD_15_0.png","I_Dist_200_LN_3_LD_4_RN_11_RD_20_0.png","I_Dist_200_LN_4_LD_5_RN_6_RD_10_0.png","I_Dist_200_LN_4_LD_6_RN_14_RD_30_0.png","I_Dist_200_LN_7_LD_10_RN_12_RD_24_0.png","I_Dist_200_LN_7_LD_10_RN_14_RD_28_0.png","I_Dist_200_LN_7_LD_10_RN_8_RD_16_0.png"], ["I_Dist_200_LN_11_LD_20_RN_3_RD_4_1.png","I_Dist_200_LN_14_LD_30_RN_12_RD_18_1.png","I_Dist_200_LN_14_LD_30_RN_6_RD_9_1.png","I_Dist_200_LN_3_LD_10_RN_1_RD_2_1.png","I_Dist_200_LN_4_LD_30_RN_1_RD_3_1.png","I_Dist_200_LN_6_LD_20_RN_3_RD_6_1.png","I_Dist_200_LN_7_LD_15_RN_4_RD_6_1.png","I_Dist_200_LN_7_LD_15_RN_6_RD_9_1.png","I_Dist_200_LN_9_LD_15_RN_8_RD_10_1.png"]],
		dist200_S: [["E_Dist_200_LN_3_LD_6_RN_3_RD_10_0.png"], ["E_Dist_200_LN_3_LD_10_RN_3_RD_6_1.png"]],
		
		dist300_C: [["C_Dist_300_LN_11_LD_22_RN_1_RD_5_0.png","C_Dist_300_LN_11_LD_22_RN_2_RD_10_0.png","C_Dist_300_LN_11_LD_22_RN_4_RD_20_0.png","C_Dist_300_LN_12_LD_24_RN_2_RD_10_0.png","C_Dist_300_LN_18_LD_20_RN_9_RD_15_0.png","C_Dist_300_LN_20_LD_25_RN_13_RD_26_0.png","C_Dist_300_LN_20_LD_25_RN_14_RD_28_0.png","C_Dist_300_LN_20_LD_25_RN_5_RD_10_0.png","C_Dist_300_LN_20_LD_25_RN_8_RD_16_0.png","C_Dist_300_LN_20_LD_25_RN_9_RD_18_0.png","C_Dist_300_LN_24_LD_30_RN_2_RD_4_0.png","C_Dist_300_LN_24_LD_30_RN_8_RD_16_0.png","C_Dist_300_LN_3_LD_6_RN_2_RD_10_0.png","C_Dist_300_LN_4_LD_10_RN_1_RD_10_0.png","C_Dist_300_LN_4_LD_5_RN_2_RD_4_0.png","C_Dist_300_LN_8_LD_16_RN_1_RD_5_0.png","C_Dist_300_LN_9_LD_10_RN_3_RD_5_0.png"], ["C_Dist_300_LN_1_LD_20_RN_7_RD_20_1.png","C_Dist_300_LN_1_LD_3_RN_19_RD_30_1.png","C_Dist_300_LN_1_LD_30_RN_8_RD_24_1.png","C_Dist_300_LN_1_LD_5_RN_11_RD_22_1.png","C_Dist_300_LN_1_LD_5_RN_3_RD_6_1.png","C_Dist_300_LN_1_LD_5_RN_6_RD_12_1.png","C_Dist_300_LN_2_LD_10_RN_12_RD_24_1.png","C_Dist_300_LN_2_LD_20_RN_10_RD_25_1.png","C_Dist_300_LN_3_LD_12_RN_11_RD_20_1.png","C_Dist_300_LN_3_LD_6_RN_4_RD_5_1.png","C_Dist_300_LN_4_LD_20_RN_13_RD_26_1.png","C_Dist_300_LN_5_LD_25_RN_6_RD_12_1.png","C_Dist_300_LN_5_LD_25_RN_7_RD_14_1.png","C_Dist_300_LN_7_LD_14_RN_20_RD_25_1.png","C_Dist_300_LN_8_LD_15_RN_10_RD_12_1.png"]], // congruent
		dist300_I: [["I_Dist_300_LN_1_LD_2_RN_2_RD_10_0.png","I_Dist_300_LN_1_LD_2_RN_3_RD_15_0.png","I_Dist_300_LN_2_LD_4_RN_6_RD_30_0.png","I_Dist_300_LN_3_LD_6_RN_4_RD_20_0.png","I_Dist_300_LN_4_LD_5_RN_6_RD_12_0.png","I_Dist_300_LN_4_LD_5_RN_8_RD_16_0.png","I_Dist_300_LN_7_LD_10_RN_8_RD_20_0.png","I_Dist_300_LN_8_LD_10_RN_14_RD_28_0.png","I_Dist_300_LN_8_LD_10_RN_9_RD_18_0.png"], ["I_Dist_300_LN_13_LD_26_RN_12_RD_15_1.png","I_Dist_300_LN_4_LD_20_RN_2_RD_4_1.png"]],
		dist300_S: [["E_Dist_300_LN_9_LD_12_RN_9_RD_20_0.png"], ["E_Dist_300_LN_18_LD_30_RN_18_RD_20_1.png","E_Dist_300_LN_3_LD_10_RN_3_RD_5_1.png","E_Dist_300_LN_9_LD_20_RN_9_RD_12_1.png"]],
		
		dist500_C: [["C_Dist_500_LN_10_LD_13_RN_7_RD_26_0.png","C_Dist_500_LN_10_LD_15_RN_4_RD_24_0.png","C_Dist_500_LN_12_LD_16_RN_3_RD_12_0.png","C_Dist_500_LN_12_LD_18_RN_4_RD_24_0.png","C_Dist_500_LN_15_LD_18_RN_5_RD_15_0.png","C_Dist_500_LN_15_LD_20_RN_1_RD_4_0.png","C_Dist_500_LN_18_LD_27_RN_1_RD_6_0.png","C_Dist_500_LN_20_LD_24_RN_1_RD_3_0.png","C_Dist_500_LN_20_LD_24_RN_3_RD_9_0.png","C_Dist_500_LN_20_LD_24_RN_7_RD_21_0.png","C_Dist_500_LN_20_LD_28_RN_3_RD_14_0.png","C_Dist_500_LN_21_LD_28_RN_6_RD_24_0.png","C_Dist_500_LN_22_LD_28_RN_2_RD_7_0.png","C_Dist_500_LN_25_LD_30_RN_9_RD_27_0.png","C_Dist_500_LN_4_LD_6_RN_1_RD_6_0.png","C_Dist_500_LN_5_LD_6_RN_2_RD_6_0.png","C_Dist_500_LN_6_LD_9_RN_1_RD_6_0.png","C_Dist_500_LN_7_LD_10_RN_1_RD_5_0.png","C_Dist_500_LN_8_LD_12_RN_1_RD_6_0.png","C_Dist_500_LN_8_LD_12_RN_4_RD_24_0.png"], ["C_Dist_500_LN_1_LD_4_RN_12_RD_16_1.png","C_Dist_500_LN_1_LD_4_RN_9_RD_12_1.png","C_Dist_500_LN_1_LD_9_RN_11_RD_18_1.png","C_Dist_500_LN_10_LD_24_RN_22_RD_24_1.png","C_Dist_500_LN_2_LD_12_RN_10_RD_15_1.png","C_Dist_500_LN_2_LD_12_RN_12_RD_18_1.png","C_Dist_500_LN_2_LD_12_RN_4_RD_6_1.png","C_Dist_500_LN_2_LD_24_RN_7_RD_12_1.png","C_Dist_500_LN_2_LD_5_RN_18_RD_20_1.png","C_Dist_500_LN_2_LD_5_RN_9_RD_10_1.png","C_Dist_500_LN_2_LD_8_RN_12_RD_16_1.png","C_Dist_500_LN_2_LD_8_RN_21_RD_28_1.png","C_Dist_500_LN_3_LD_10_RN_4_RD_5_1.png","C_Dist_500_LN_3_LD_12_RN_15_RD_20_1.png","C_Dist_500_LN_3_LD_30_RN_6_RD_10_1.png","C_Dist_500_LN_3_LD_8_RN_14_RD_16_1.png","C_Dist_500_LN_4_LD_16_RN_15_RD_20_1.png","C_Dist_500_LN_4_LD_24_RN_12_RD_18_1.png","C_Dist_500_LN_5_LD_14_RN_6_RD_7_1.png","C_Dist_500_LN_7_LD_21_RN_20_RD_24_1.png","C_Dist_500_LN_7_LD_28_RN_12_RD_16_1.png","C_Dist_500_LN_7_LD_28_RN_9_RD_12_1.png","C_Dist_500_LN_9_LD_27_RN_20_RD_24_1.png"]], // congruent
		dist500_I: [["I_Dist_500_LN_2_LD_3_RN_4_RD_24_0.png","I_Dist_500_LN_5_LD_6_RN_6_RD_18_0.png","I_Dist_500_LN_7_LD_8_RN_9_RD_24_0.png"], ["I_Dist_500_LN_7_LD_21_RN_5_RD_6_1.png"]],
		dist500_S: [["E_Dist_500_LN_6_LD_8_RN_6_RD_24_0.png"], ["E_Dist_500_LN_2_LD_12_RN_2_RD_3_1.png","E_Dist_500_LN_6_LD_24_RN_6_RD_8_1.png"]]
		
			
  	}
	
	var fd = Math.max(test.fix_dur[0], Math.random()*test.fix_dur[1]); //fix duration
	var trial_data = {
			start_time: null, //Stimulus on
			click_time: null, //target touched
			finger_time: null, //finger/mouse left start region
			fix_duration: fd, //min, max (ms)
			trial: trial,
			RT: null, //Response time
			MT: null, //Movement time
			sideResp: null, //subjects response 1 left, 2 right
	        stimulus: null,
	  		xmouse: [],
	  		ymouse: [],
	  		timestamp_mouse: [],
			xSR: xSR, //Start region coord.
			ySR: ySR, 
			xT1: xT1, //Target 1 coord.
			yT1: yT1, 
			xT2: xT2, //Target 2 coord.
			yT2: yT2, 
			toosoon: 0, //left start region too soon: 1 yes; 0 no i.e. 0 is a good trial
			cond_shown: [], //IMPORTANT: condition shown each trial as described in exp_cond_rep i.e. this is exp_cond_rep randomized (see below) 
	 		ratio_trial:[], //IMPORTANT: ratio distance on trial (over 1000)
			L_num: [], //IMPORTANT: left numerator on trial
			L_den: [], //IMPORTANT: left denominator on trial
			R_num: [], //IMPORTANT: right numerator on trial
			R_den: [], //IMPORTANT: right denominator on trial
			correct_side: [], //IMPORTANT: side of larger ratio (0 left, 1 right)
			subjID: 9999999999,
			gender: 99, //0 male, 1 female
			age: 0, //years
			school: 0, //curso del estudiante
			test: test      		
	}
	
  	
	
	//Randomization of trials i.e. images shown 
	let f = (a, b) => [].concat(...a.map(a => b.map(b => [].concat(a, b))));
	let cartesian = (a, b, ...c) => b ? cartesian(f(a, b), ...c) : a; //Cartesian product
	var exp_conditions =  cartesian(test.ratios,test.img_types); // all experimental conditions i.e. ratios X img_types
	var repeatelem = function(elem, n){
	    // returns an array with element elem repeated n times.
	    var arr = [];

	    for (var i = 0; i <= n; i++) {
	        arr = arr.concat(elem);
	    };

	    return arr;
	};	
	var exp_cond_rep = repeatelem(exp_conditions,test.rep_conds)
	//test.nTrials = exp_cond_rep.length
	test.nTrials = 15
	var bucket = []; //bucket of integers to sample without replacement
	for (var i=0; i<test.nTrials; i++) {
	    bucket.push(i);
	}
	function getRandomFromBucket() {
	   var randomIndex = Math.floor(Math.random()*bucket.length);
	   return bucket.splice(randomIndex, 1)[0];
	}
	for (var i=0; i<test.nTrials; i++) {
	    test.Trials_order.push(getRandomFromBucket()) 
	}
	var cs = ['/L/', '/R/']
	var patt1 = /[0-9]+/g //this regular expression finds numbers in the file name
	for(var i = 0; i<test.nTrials; i++){ //This loops adds information to the variable test about each trial e.g. img, ratio, left_num, right_num, correct_side ...
  	 
  	  // GENERAL EXPRESSION TO GET NUMBERS FROM NAME FILES
		test.cond_shown.push(exp_cond_rep[test.Trials_order[i]][1])
		test.ratio_trial.push(exp_cond_rep[test.Trials_order[i]][0])
	  	test.correct_side.push(Math.floor(Math.random() * 2)) //0 left, 1 right
		
	  
		// IMPORTANT: for the following conditionals see test.ratios and modify accordingly
		if (test.ratio_trial[i]==100){ 
			if (test.cond_shown[i]=='Congruent'){
				im = test.dist100_C[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Incongruent'){
				im = test.dist100_I[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Equal'){
				im = test.dist100_S[test.correct_side[i]]
			}	
		} else if (test.ratio_trial[i]==200){
			if (test.cond_shown[i]=='Congruent'){
				im = test.dist200_C[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Incongruent'){
				im = test.dist200_I[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Equal'){
				im = test.dist200_S[test.correct_side[i]]
			}
		} else if (test.ratio_trial[i]==300){
			if (test.cond_shown[i]=='Congruent'){
				im = test.dist300_C[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Incongruent'){
				im = test.dist300_I[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Equal'){
				im = test.dist300_S[test.correct_side[i]]
			}
		} else if (test.ratio_trial[i]==500){
			if (test.cond_shown[i]=='Congruent'){
				im = test.dist500_C[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Incongruent'){
				im = test.dist500_I[test.correct_side[i]]
			} else if (test.cond_shown[i]=='Equal'){
				im = test.dist500_S[test.correct_side[i]]
			}
		} 
	  	
		
		temp = Math.floor(Math.random() * im.length) // picks random image for the current ratio and condition
		file_name = "img2/" + test.ratio_trial[i] + "/" + test.cond_shown[i] + cs[test.correct_side[i]] + im[temp]
  	  	result = file_name.match(patt1) //regular expression match
		test.left_num.push(Number(result[3]))
		test.left_den.push(Number(result[4]))
		test.right_num.push(Number(result[5]))
		test.right_den.push(Number(result[6]))
		
	
		test.img_shown.push(file_name)
		
		test.correct_side[i] = test.correct_side[i] + 1 //this changes to 1 left and 2 right (so it matches side_resp in trial_data
	}
   
   
   
    /////////////// PAGE/HTML SETUP	////////////// 
  	//Area on-screen where x,y mouse coordinates are collected
	
  	var resp_area = document.querySelector("body")
  	resp_area.setAttribute("id","myB");
	resp_area.setAttribute("ontouchmove","myTouch2(e)");
	resp_area.setAttribute("style","z-index=4"); 
  	var myB = document.getElementById("myB");
  	var rect = myB.getBoundingClientRect();
	
	
  	//HTML element styles
    var head = document.querySelector("head")
    var newStyle = document.createElement("style");
	
	
  	//Area on-screen of response targets 
  	//You can add more targets to a container (more id target#) 
  	//if you want more targets at different horizontal coordinates create more containers
  	//IMPORTANT: if you add more targets update myClick function e.g. add resp_area.removeChild(document.querySelector("#target4"));
  	var newCanvas = document.createElement("canvas");
  	newCanvas.setAttribute("class","canvas");
  	newCanvas.setAttribute("id","canvas1");
  	newCanvas.setAttribute("width", rect.width);
  	newCanvas.setAttribute("height", rect.height);
	newCanvas.setAttribute("style","position:fixed; top:0; left:0; z-index: -1");
	//newCanvas.setAttribute("ontouchmove","myTouch2(e)");
  	resp_area.appendChild(newCanvas);	
	//resp_area.insertBefore(newCanvas, document.getElementById("O"));	
	
	
  	var canvas = document.getElementById("canvas1");
  	var ctx = canvas.getContext("2d");
  	ctx.fillStyle = "#FF0000";
	
  	//Target 1
  	var prop = test.targets_relative_coord[0]*rect.width - test.targets_dim[1]*0.5
  	//prop = prop/rect.width
  	var xT1 = prop; //prop*rect.width; //Coord. target 1
  	var yT1 = 0;
  	//ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]); 
	
  	//Target 2
  	prop = test.targets_relative_coord[1]*rect.width - test.targets_dim[1]*0.5
  	//prop = prop/rect.width
  	var xT2 = prop; //prop*rect.width; //Coord. target 2
  	var yT2 = 0;
  	//ctx.fillRect(xT2,yT2,test.targets_dim[1],test.targets_dim[0]); 
	
  	//Start region
	var vert_offset_SR = 0.65
  	prop = 50*rect.width/100 - test.start_dim[1]*0.5
  	prop = prop/rect.width
  	var xSR = prop*rect.width; //Coord. start region
  	var ySR = vert_offset_SR*rect.height;
  	ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]); 
	
  	//Stimulus image
	var tempN = 1 + getRandomInt(20) //number of images  in folder for each side
	var tempS = getRandomInt(2) //side
	if (tempS == 0){
		tempS = 'L'
		test.correct_side[trial] = 1
	} else if (tempS == 1) {
		tempS = 'R'
		test.correct_side[trial] = 2
	}
	var file_name = "img2/Train/t_C_" + tempS + tempN + ".jpg"
	document.getElementById("ph").src = file_name;
	//document.getElementById("ph").src = test.img_shown[trial];
	//document.getElementById("ph").height = 50;
	//document.getElementById("ph").width = 50;	
	scaaling = 0.7	//determines how much the original image is reduced/increased
	heeight = document.getElementById("ph").naturalHeight;
	wiidth = document.getElementById("ph").naturalWidth;
  	prop = 0.5*rect.width - scaaling*wiidth*0.5
  	prop = prop/rect.width	  
  	var xStim = prop*rect.width; //Coord. stimulus
  	var yStim = 0.2*rect.height; 
 
	
  	//Fixation
  	prop = .5*rect.width - test.size_fix*0.5
  	prop = prop/rect.width	
  	var xFix = prop*rect.width; //Coord. fix
  	var yFix = 0.4*rect.height;
  	//ctx.fillStyle = "#000000";
  	//ctx.font = test.size_fix + "px Arial";
  	//ctx.fillText("+",xFix,yFix); 
	  
  	var elem = document.documentElement;
  	
	
	////////////////  FUNCTIONS ////////////// 
	// /storage/emulated/0/Numexp/experimentRDMCanvas.html
	
  	//function to handle non-clickable events
  	var myMouse = function(e){
		xM = e.clientX; //x position of finger or mouse
		yM = e.clientY; //y position of finger or mouse
		mySubjCheck()
				
  	}
		
	
  	var myTouch = function(e){
		e.preventDefault()
		xM = e.touches[0].clientX; //x position of finger or mouse
		yM = e.touches[0].clientY; //y position of finger or mouse
		mySubjCheck()	
  	}
	
	function myTouch2(e) {
		e.preventDefault()
		xM = e.touches[0].clientX; //x position of finger or mouse
		yM = e.touches[0].clientY; //y position of finger or mouse
		mySubjCheck()
	}
	
  	var myTouch3 = function(e){
		e.preventDefault()
		resp_area.addEventListener("touchmove", myTouch);	
  	}
	
	function mySubjID() {
	  prompt("Empezar Entrenamiento", "Oprime ok");
	  trial_data.subjID = 12345;
	  trial_data.age = 0;
	  trial_data.school = 0;
	  trial_data.gender = 0;
  		removeElement('sid')
  		removeElement('Xc')
  		removeElement('Yc') 
		elem.webkitRequestFullscreen();
	}
	
	function mySubjCheck() { //To wait for a subjID
		if (trial_data.subjID == 9999999999){
			xM = 0
			yM = 0
			document.getElementById('Xc').innerHTML = 'Por favor presione el boton SID en la esquina superior izquierda'
			document.getElementById('Yc').innerHTML = 'Por favor presione el boton SID en la esquina superior izquierda'
		} else {
			//Comment out or in if online position of the mouse/finger should be displayed
			//document.getElementById('Xc').innerHTML = 'xSR: ' + Math.round(xSR) + '  xT1: ' + xT1 + '  xT2: ' + xT2 + '  xM: ' + xM
			//document.getElementById('Yc').innerHTML = 'ySR: ' + Math.round(ySR) + '  yT1: ' + yT1 + '  yT2: ' + yT2 + '  yM: ' + yM
			//removeElement('Xc')
			//removeElement('Yc')
		}	
	}
	
	//Check full screen (FOR CHROME, Safari use: webkitfullscreenchange; For firefox use: mozfullscreenchange; for Microsoft explorers: msfullscreenchange)
	document.addEventListener("webkitfullscreenchange", function() {
 		rect = document.getElementById("myB").getBoundingClientRect();		
 		resp_area.removeChild(newCanvas)
 		newCanvas = document.createElement("canvas");
 		newCanvas.setAttribute("class","canvas");
 		newCanvas.setAttribute("id","canvas1");
 		newCanvas.setAttribute("width", rect.width);
 	  	newCanvas.setAttribute("height", rect.height);
 	  	newCanvas.setAttribute("style","position:fixed; top:0; left:0; z-index: -1");
		//newCanvas.setAttribute("ontouchmove","myTouch2(e)");
 	  	resp_area.appendChild(newCanvas);
		
		
 	  	canvas = document.getElementById("canvas1");
 	  	ctx = canvas.getContext("2d");
		
		
 		prop = test.targets_relative_coord[0]*rect.width - test.targets_dim[1]*0.5
 	  	//prop = prop/rect.width
 	  	xT1 = prop; //prop*rect.width; //Coord. target 1
 	  	yT1 = 0;
 	  	prop = test.targets_relative_coord[1]*rect.width - test.targets_dim[1]*0.5
 	  	//prop = prop/rect.width
 	  	xT2 = prop; // prop*rect.width; //Coord. target 2
 	  	yT2 = 0;
 	  	prop = 50*rect.width/100 - test.start_dim[1]*0.5
 	  	prop = prop/rect.width
 	  	xSR = prop*rect.width; //Coord. start region
 	  	ySR = vert_offset_SR*rect.height;	
		
	  	//Fixation
	  	prop = .5*rect.width - test.size_fix*0.5
	  	prop = prop/rect.width	
	  	xFix = prop*rect.width; //Coord. fix
	  	yFix = 0.4*rect.height; 
		
		
		
		//Start region
		ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);  
		
		//target 1
		ctx.fillStyle = "#FF0000";
		ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]); 
		

		//target 2
		ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]); 
 		
		//window.scrollTo(0, 0)	
		//document.getElementById("myB").focus();
	});
	
	
	function removeElement(elementId) {
	    // Removes an element from the document
	    var element = document.getElementById(elementId);
	    element.parentNode.removeChild(element);
	}
	
	//Initialize listeners
	resp_area.addEventListener('mousemove', myMouse);
	//resp_area.addEventListener("touchmove", myTouch);
	resp_area.addEventListener("touchstart", myTouch3);
	
	
	
	//IMPORTANT function controlling exp. flow and to colllect mouse/finger coordinates and check target hit
	var myI = setInterval(function(){
		 
		if (trial%test.trials_to_rest == 0 & trial>0 & rest == 0){ //BREAK
			if (rest_temp == 0){
				rest_temp = 1
				ctx.fillStyle = "#000000";
				ctx.font = "20px Arial";
				ctx.fillText("Descansa. Muevete al rectangulo verde cuando desees continuar", 0.35*xFix,yFix);	
				ctx.fillStyle = "#228B22";
				ctx.fillRect(xSR,ySR,test.start_dim[1],test.start_dim[0]); 
			}
			 
			if (xM > xSR && xM < (xSR + test.start_dim[1]) && yM > ySR && yM < (ySR + test.start_dim[0])){ //finger is inside start region
				rest = 1;
				clearScreen();
				//Start region
				ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);  
		
				//target 1
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]); 
		
				//target 2
				ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]); 
		
			}
		
			
		} else if (xM > xSR && xM < (xSR + test.start_dim[1]) && yM > ySR && yM < (ySR + test.start_dim[0])){
			//If inside start region do this:			
			//TIMELINE
			rest_temp = 0;
			//if (trialStarted == 10 || trialStarted == 0) {
			if (fixOn == 0) {	
				fixOn = 1;	
				leftSR = 0;
				myFixAppears = setTimeout(function(){ 
					ctx.fillStyle = "#000000";
					ctx.font = test.size_fix + "px Arial";
					ctx.fillText("+",xFix,yFix); //Fixation						
				}, 100)
				
				
				fd = Math.max(test.fix_dur[0], Math.random()*test.fix_dur[1]); //fix duration
				myFixGone = setTimeout(function(){ 
					ctx.fillStyle = "#FFFFFF"; //Has to be same background color
					ctx.fillRect(0.43*rect.width, 0.3*rect.height, 200, 200); //cover up fixation 	
				}, fd)
							
				myStimAppears = setTimeout(function(){					
					loadStuff();										
				}, fd + 200) //fd + # where # is how much after fix dissapears the stimulus images appear
				
				myStimDisappears = setTimeout(function(){					
					clearScreen();
					//Start region
					ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);  
		
					//target 1
					ctx.fillStyle = "#FF0000";
					ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]); 
		

					//target 2
					ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]); 					
				}, fd + 200 + test.timestim)
							
			}
		   //trialStarted = 1;		
		}
		
		if ((xM < xSR || xM > (xSR + test.start_dim[1]) || yM < ySR || yM > (ySR + test.start_dim[0])) && leftSR == 0 && trialStarted == 0 ){
			trial_data.finger_time = Date.now(); //mouse/finger left the start region 
			leftSR = 1;			
			if (stimOn==0){
				clearScreen();	
				clearTimeout(myFixGone);
				clearTimeout(myStimAppears);
				clearTimeout(myFixAppears);	
				clearTimeout(myStimDisappears);	
				//trial_data.toosoon = 1;			
				//DATA.push(JSON.parse(JSON.stringify(trial_data))); 
				//stimOn = 0;
				//trialStarted = 0;
				//fixOn = 0;
				//leftSR = 0;
				init_trial_data();
				ctx.fillStyle = "#000000";
				ctx.font = "20px Arial";
				ctx.fillText("Espera en la posicion inicial hasta ver los puntos", 0.8*xFix,yFix);	
				//resp_area.removeEventListener('mousemove', myMouse);
				myPenalty = setTimeout(function(){
					clearScreen();
					ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);
					fixOn = 0;
					//leftSR = 0;										 		
				}, 1500)
				if (trial == test.nTrials - 1) {
					clearInterval(myI);
					clearTimeout(myPenalty);
					clearScreen();
					resp_area.removeEventListener('mousemove', myMouse);
					//resp_area.removeEventListener('touchmove', myTouch);					
					resp_area.removeEventListener('touchstart', myTouch3);					
					ctx.fillStyle = "#000000";
					ctx.font = "20px Arial";
					ctx.fillText("Espera en la posicion inicial ... gracias por tu participacion",xFix,yFix); 
					saveText(JSON.stringify(DATA), trial_data.subjID + "_trainRATIO_data.json");
				}	
				//trial = trial + 1;	
			}
		}
		
		if (trialStarted == 1 && stimOn == 1 ) {
			ts = Date.now()-trial_data.start_time;
			trial_data.xmouse.push(xM);
		    trial_data.ymouse.push(yM);
			trial_data.timestamp_mouse.push(ts);
			if (xM < xSR || xM > (xSR + test.start_dim[1]) || yM < ySR || yM > (ySR + test.start_dim[0])) { //erases stimulus image once the index finger moved out of the start position and moves towards a target 	
				if (leftSR == 0) {
					trial_data.finger_time = Date.now();
				}				
				leftSR = 1;
				ctx.fillStyle = "#FFFFFF"; //Has to be same background color
				ctx.fillRect(0, 0, rect.width, rect.height); 
				//Start region
				ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);  
		
				//target 1
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]); 
		

				//target 2
				ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]); 
			}	
			
			
			if (xM  > xT1 && xM  < (xT1 + test.targets_dim[1]) && yM  > yT1 && yM  < (yT1 + test.targets_dim[0]) && trial_data.toosoon == 0){ //hit target 1
				clearTimeout(myFixGone);
				clearTimeout(myStimAppears);
				clearTimeout(myFixAppears);
				clearTimeout(myStimDisappears);	
				clearScreen()
				trial_data.cond_shown = test.cond_shown[trial]; 
	 			trial_data.ratio_trial = test.ratio_trial[trial]; 
				trial_data.L_num = test.left_num[trial];
				trial_data.L_den = test.left_den[trial];
				trial_data.R_num = test.right_num[trial];
				trial_data.R_den = test.right_den[trial];	
				trial_data.correct_side = test.correct_side[trial]; 				
				trial_data.sideResp = 1;
				trial_data.click_time = Date.now();
				trial_data.RT = trial_data.finger_time - trial_data.start_time;  					
				trial_data.MT = trial_data.click_time - trial_data.finger_time;
				//trial_data.toosoon = 0;
				DATA.push(JSON.parse(JSON.stringify(trial_data))); //IMPORTANT: DATA	
				trial = trial + 1;
				rest = 0;
				trialStarted = 0;
				stimOn = 0;						
				//leftSR = 0;
				if (trial_data.correct_side != trial_data.sideResp && trial_data.ratio_trial<1000){ //error feedback
					//feedback = 400 //ms; feeedback duration
					myFeedback = setTimeout(function(){	
						ctx.fillStyle = "#000000";
						if (trial_data.correct_side == 1) { //left
							//target 1		
							ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]);
						} else { //right
							//target 2
							ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]);
						}
						ctx.fillStyle = "#000000";
						ctx.font = "20px Arial";
						ctx.fillText("ERROR",xFix,yFix); 			 
												
					}, 5) 
				
					myFeedbackGone = setTimeout(function(){					
						clearScreen()	
						//feedback = 0
						fixOn = 0;
						//Start region
						ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);
						//init_trial_data();									
					}, feedback)
					
				} else {
					clearScreen()
					//feedback = 0
					fixOn = 0;
					//init_trial_data();
				}					  				
				init_trial_data();
							
				
			
				if (trial < test.nTrials){
					ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]); 
					
				
				} else {
					clearInterval(myI);
					resp_area.removeEventListener('mousemove', myMouse);
					//resp_area.removeEventListener('touchmove', myTouch);					
					resp_area.removeEventListener('touchstart', myTouch3);					
					ctx.fillStyle = "#000000";
					ctx.font = "20px Arial";
					ctx.fillText("Thanks for your participation",xFix,yFix); 
					saveText(JSON.stringify(DATA), trial_data.subjID + "_trainRATIO_data.json");
				}
				
			} else if (xM  > xT2 && xM  < (xT2 + test.targets_dim[1]) && yM  > yT2 && yM  < (yT2 + test.targets_dim[0]) && trial_data.toosoon == 0) { //hit target 2
				clearTimeout(myFixGone);
				clearTimeout(myStimAppears);
				clearTimeout(myFixAppears);
				clearTimeout(myStimDisappears);
				clearScreen()
				trial_data.cond_shown = test.cond_shown[trial]; 
	 			trial_data.ratio_trial = test.ratio_trial[trial]; 
				trial_data.L_num = test.left_num[trial];
				trial_data.L_den = test.left_den[trial];
				trial_data.R_num = test.right_num[trial];
				trial_data.R_den = test.right_den[trial];
				trial_data.correct_side = test.correct_side[trial]; 				
				trial_data.sideResp = 2;
				trial_data.click_time = Date.now();
				trial_data.RT = trial_data.finger_time - trial_data.start_time;  					
				trial_data.MT = trial_data.click_time - trial_data.finger_time;
				//trial_data.toosoon = 0;
				DATA.push(JSON.parse(JSON.stringify(trial_data))); //IMPORTANT: DATA
				trial = trial + 1;	
				rest = 0;
				trialStarted = 0;
				stimOn = 0;		
				//leftSR = 0;	
				if (trial_data.correct_side != trial_data.sideResp && trial_data.ratio_trial<1000){ //error feedback
					//feedback = 400 //ms; feeedback duration
					myFeedback = setTimeout(function(){	
						ctx.fillStyle = "#000000";
						if (trial_data.correct_side == 1) { //left
							//target 1		
							ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]);
						} else { //right
							//target 2
							ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]);
						}
						ctx.fillStyle = "#000000";
						ctx.font = "20px Arial";
						ctx.fillText("ERROR",xFix,yFix); 			 
												
					}, 5) 
				
					myFeedbackGone = setTimeout(function(){					
						clearScreen()	
						//feedback = 0
						fixOn = 0;
						//Start region
						ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);
						//init_trial_data();									
					}, feedback)
					
				} else {
					clearScreen()
					//feedback = 0
					fixOn = 0;
					//init_trial_data();
				}
								  				
				init_trial_data();
			
				if (trial < test.nTrials){
					ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]); 
				
				
				} else {
					clearInterval(myI);
					resp_area.removeEventListener('mousemove', myMouse);
					//resp_area.removeEventListener('touchmove', myTouch);					
					resp_area.removeEventListener('touchstart', myTouch3);					
					ctx.fillStyle = "#000000";
					ctx.font = "20px Arial";
					ctx.fillText("Thanks for your participation",xFix,yFix); 
					saveText(JSON.stringify(DATA), trial_data.subjID + "_trainRATIO_data.json");
				}							
		 	}
	  	}
	}, test.samplingrate)  
	
	//function to clear screen
	var clearScreen = function (){
		ctx.fillStyle = "#FFFFFF"; //Has to be same background color
		ctx.fillRect(0, 0, rect.width, rect.height); 
		//resp_area.setAttribute("ontouchmove","myTouch2(e)"); 
		//newCanvas.setAttribute("ontouchmove","myTouch2(e)");
		
		//Remove fix
		//ctx.fillStyle = "#FFFFFF"; //Has to be same background color
		//ctx.fillRect(0.43*rect.width, 0.3*rect.height, 100, 100); 
		
		
		//Remove start region
		//ctx.fillStyle = "#FFFFFF";
		//ctx.fillRect(0.9*xSR, ySR, 2*test.start_dim[1], 1.1*test.start_dim[0]);   

		//Remove target 1
		//ctx.fillRect(0.9*xT1, yT1, 2*test.targets_dim[1], 1.1*test.targets_dim[0]); 


		//Remove target 2
		//ctx.fillRect(0.9*xT2, yT2, 2*test.targets_dim[1], 1.1*test.targets_dim[0]); 


		//Remove stimulus (image)			
		//ctx.fillRect(xStim, yStim, 2*test.size_stim[1], 2*test.size_stim[0]);
	}
	
	//function to empty the global variable trial_data
	var init_trial_data = function(){
		if (trial > 0) {
			trial_data = {
				start_time: null, //Stimulus on
				click_time: null, //target touched
				finger_time: null, //finger/mouse left start region
				fix_duration: fd,
				trial: trial,
				RT: null, //Response time
				MT: null, //Movement time
				sideResp: null, //subjects response 1 left, 2 right
		        stimulus: [], //test.img_shown[trial],
		  		xmouse: [],
		  		ymouse: [],
		  		timestamp_mouse: [],
				xSR: xSR, //Start region coord.
				ySR: ySR, 
				xT1: xT1, //Target 1 coord.
				yT1: yT1, 
				xT2: xT2, //Target 2 coord.
				yT2: yT2, 
				toosoon: 0, //left start region too soon: 1 yes; 0 no i.e. 0 is a good trial
				cond_shown: [], //IMPORTANT: condition shown each trial as described in exp_cond_rep i.e. this is exp_cond_rep randomized (see below) 
		 		ratio_trial:[], //IMPORTANT: ratio shown on trial (over 1000)
				L_num: [],
				L_den: [],
				R_num: [],
				R_den: [],
				correct_side: [], //IMPORTANT: side of larger ratio (1 left, 2 right)
				subjID: trial_data.subjID,
				gender: trial_data.gender, //0 male, 1 female
				school: trial_data.school,
				age: trial_data.age, //years
				//test: test      		
			}
		} else if (trial == 0){
			trial_data = {
				start_time: null, //Stimulus on
				click_time: null, //target touched
				finger_time: null, //finger/mouse left start region
				fix_duration: fd,
				trial: trial,
				RT: null, //Response time
				MT: null, //Movement time
				sideResp: null, //subjects response 1 left, 2 right
		        stimulus: [],//test.img_shown[trial],
		  		xmouse: [],
		  		ymouse: [],
		  		timestamp_mouse: [],
				xSR: xSR, //Start region coord.
				ySR: ySR, 
				xT1: xT1, //Target 1 coord.
				yT1: yT1, 
				xT2: xT2, //Target 2 coord.
				yT2: yT2, 
				toosoon: 0, //left start region too soon: 1 yes; 0 no i.e. 0 is a good trial
				cond_shown: [], //IMPORTANT: condition shown each trial as described in exp_cond_rep i.e. this is exp_cond_rep randomized (see below) 
		 		ratio_trial:[], //IMPORTANT: ratio shown on trial (over 1000)
				L_num: [],
				L_den: [],
				R_num: [],
				R_den: [],
				correct_side: [], //IMPORTANT: side of larger ratio (1 left, 2 right)
				subjID: trial_data.subjID,
				gender: trial_data.gender, //0 male, 1 female
				age: trial_data.age, //years
				school: trial_data.school,
				test: test      		
			}
		}
		
 		rect = document.getElementById("myB").getBoundingClientRect();		
 		resp_area.removeChild(newCanvas)
 		newCanvas = document.createElement("canvas");
 		newCanvas.setAttribute("class","canvas");
 		newCanvas.setAttribute("id","canvas1");
 		newCanvas.setAttribute("width", rect.width);
 	  	newCanvas.setAttribute("height", rect.height);
 	  	newCanvas.setAttribute("style","position:fixed; top:0; left:0; z-index: -1");
		//newCanvas.setAttribute("ontouchmove","myTouch2(e)");
 	  	resp_area.appendChild(newCanvas);
		
		
 	  	canvas = document.getElementById("canvas1");
 	  	ctx = canvas.getContext("2d");
		
		
 		prop = test.targets_relative_coord[0]*rect.width - test.targets_dim[1]*0.5
 	  	//prop = prop/rect.width
 	  	xT1 = prop; //prop*rect.width; //Coord. target 1
 	  	yT1 = 0;
 	  	prop = test.targets_relative_coord[1]*rect.width - test.targets_dim[1]*0.5
 	  	//prop = prop/rect.width
 	  	xT2 = prop; // prop*rect.width; //Coord. target 2
 	  	yT2 = 0;
 	  	prop = 50*rect.width/100 - test.start_dim[1]*0.5
 	  	prop = prop/rect.width
 	  	xSR = prop*rect.width; //Coord. start region
 	  	ySR = vert_offset_SR*rect.height;	
		
	  	//Fixation
	  	prop = .5*rect.width - test.size_fix*0.5
	  	prop = prop/rect.width	
	  	xFix = prop*rect.width; //Coord. fix
	  	yFix = 0.4*rect.height;
		
	}
	
	//function to load new trial  	
	var loadStuff = function(){
		
	
		resp_area.addEventListener('mouseover', myMouse);
		resp_area.removeEventListener('mouseover', myMouse);
		//resp_area.addEventListener('touchmove', myTouch);
		//resp_area.removeEventListener('touchmove', myTouch);
		resp_area.addEventListener('touchstart', myTouch3);
		resp_area.removeEventListener('touchstart', myTouch3);					
		trialStarted = 1;		
		sideResp = 0; // 1 left, 2 right
		leftSR = 0; //left start region
		init_trial_data();
		

		//Start region
		ctx.strokeRect(xSR,ySR,test.start_dim[1],test.start_dim[0]);  
		
		//target 1
		ctx.fillStyle = "#FF0000";
		ctx.fillRect(xT1, yT1, test.targets_dim[1],test.targets_dim[0]); 
		

		//target 2
		ctx.fillRect(xT2, yT2, test.targets_dim[1],test.targets_dim[0]); 
		

		//Stimulus (image)
		var tempN = 1 + getRandomInt(20) //number of images  in folder for each side
		var tempS = getRandomInt(2) //side
		if (tempS == 0){
			tempS = 'L'
			test.correct_side[trial] = 1
		} else if (tempS == 1) {
			tempS = 'R'
			test.correct_side[trial] = 2
		}
		
		var file_name = "img2/Train/t_C_" + tempS + tempN + ".jpg"
		document.getElementById("ph").src = file_name;
		//document.getElementById("ph").src = test.img_shown[trial];
		//document.getElementById("ph").height = 50;
		//document.getElementById("ph").width = 50;	
		scaaling = 0.7	//determines how much the original image is reduced/increased
		heeight = document.getElementById("ph").naturalHeight;
		wiidth = document.getElementById("ph").naturalWidth;
	  	prop = 0.5*rect.width - scaaling*wiidth*0.5
	  	prop = prop/rect.width	  
	  	xStim = prop*rect.width; //Coord. stimulus
	  	yStim = 0.2*rect.height; 
		
		
		//loadCanvas(test.img_shown[trial], xStim, yStim, scaaling*wiidth, scaaling*heeight) //loads stimulus image
		loadCanvas(file_name, xStim, yStim, scaaling*wiidth, scaaling*heeight) //loads stimulus image
		stimOn = 1;
		
		trial_data.start_time = Date.now();
		//trial_data.fix_duration = 1000; //Math.max(test.fix_dur[0], Math.random()*test.fix_dur[1]);
		
		
		
	}
	
	function getRandomInt(max) {
	  return Math.floor(Math.random() * Math.floor(max));
	  //e.g. console.log(getRandomInt(3)); //expected output: 0, 1 or 2
	}
	
	//function to save stuff
	function saveText(text, filename){
	  var a = document.createElement('a');
	  a.setAttribute('href', 'data:text/plain;charset=utf-u,'+encodeURIComponent(text));
	  a.setAttribute('download', filename);
	  a.click()
	}
	
	
	//function to load image in canvas
	function loadCanvas(imgsrc, xstim, ystim, width, height) {
	        var canvas = document.getElementById('canvas1');
	        var context = canvas.getContext('2d');

	        // load image from data url
	        var imageObj = new Image();
	        imageObj.onload = function() {
	          context.drawImage(this, xstim, ystim, width, height)
	        }

	        imageObj.src = imgsrc;
	 }
	
	 
   	function openFullscreen() {
		
 		
		
     	if (elem.requestFullscreen) {
       	  	elem.requestFullscreen();
    	} else if (elem.mozRequestFullScreen) { /* Firefox */
       		elem.mozRequestFullScreen();
     	} else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
       	  	elem.webkitRequestFullscreen();
     	} else if (elem.msRequestFullscreen) { /* IE/Edge */
       	  	elem.msRequestFullscreen();
     	}
		
 		
			
   	}
	
   	function closeFullscreen() {
 		
     	if (document.exitFullscreen) {
       	  document.exitFullscreen();
     	} else if (document.mozCancelFullScreen) {
       	  document.mozCancelFullScreen();
     	} else if (document.webkitExitFullscreen) {
       	  document.webkitExitFullscreen();
     	} else if (document.msExitFullscreen) {
       	  document.msExitFullscreen();
     	}
		
 		
		
   	}
  	

	
  </script>
	
</html>